SELECT
  loyalty_program_status,
  AVG(CASE WHEN coupon_status = "Used" THEN 1 ELSE 0 END) * 100 AS pct_coupon_usage,
  AVG(discount_pct) AS avg_discount_given,
  AVG(net_revenue) AS avg_revenue,
  COUNT(transaction_id) AS total_orders
FROM `retail_project2_extended.customer_transactions`
GROUP BY loyalty_program_status
ORDER BY avg_discount_given DESC;
